{{define "kit-query-parameter-decode" -}}

        {{.GoVariableName}}Str := QueryGetValue(r.URL.Query(), "{{.ParamName}}", "")
		
        {{if .Required }}
        if {{.GoVariableName}}Str == "" {
		   return nil, Error(http.StatusBadRequest, "missing required parameter '{{.ParamName}}'")
		}
        {{end}}
		

		var {{.GoVariableName}} *{{.Schema.GoType}}
		{{if eq .Schema.GoType "int" }}
  
			{{.GoVariableName}}Param, err := strconv.Atoi({{.GoVariableName}}Str)
			if err != nil {
			  return nil, Error(http.StatusBadRequest, "invalid parameter '{{.ParamName}}', int required")
			}
			{{.GoVariableName}} = &{{.GoVariableName}}Param
          {{else if eq .Schema.GoType "int64"}}
          
        {{.GoVariableName}}Param, err := strconv.ParseInt({{.GoVariableName}}Str, 10, 64)
        if err != nil {
          return nil, Error(http.StatusBadRequest, "invalid parameter '{{.ParamName}}', int required")
        }
        {{.GoVariableName}} = &{{.GoVariableName}}Param
        
        
          {{else if eq .Schema.GoType "float64"}}
          
        {{.GoVariableName}}Param, err := strconv.ParseFloat({{.GoVariableName}}Str, 64)
        if err != nil {
          return nil, Error(http.StatusBadRequest, "invalid parameter '{{.ParamName}}', double required")
        }
        {{.GoVariableName}} = &{{.GoVariableName}}Param
		
          {{else if eq .Schema.GoType "time.Time"}}
          
        {{.GoVariableName}}Param, err := time.Parse({{.GoVariableName}}Str, time.RFC3339Nano)
        if err != nil {
          return nil, Error(http.StatusBadRequest, "invalid parameter '{{.ParamName}}', RFC3339 date string required")
        }
        {{.GoVariableName}} = &{{.GoVariableName}}Param
		
        
          {{else if eq .Schema.GoType "string"}}
          
        {{.GoVariableName}} = &{{.GoVariableName}}Str
        
          {{ else }}
          
        	{{.GoVariableName}}Cast := {{.Schema.GoType}}({{.GoVariableName}}Str)
            {{.GoVariableName}} = &{{.GoVariableName}}Cast
			
  {{  if gt (len .Schema.EnumValues) 0 }}
// checking enum property '{{.ParamName}}'
  {{ if .Required }}
  if {{.GoVariableName}} != nil && !IsValid{{.Schema.GoType}}(*{{.GoVariableName}}) {
  	 return nil, Error(http.StatusBadRequest, "invalid value for '{{.ParamName}}'")
  }
  {{ else }}
  if {{.GoVariableName}} == nil || !IsValid{{.Schema.GoType}}(*{{.GoVariableName}}) {
  	 {{.GoVariableName}} = nil
  }
  {{ end }}
	
  {{end}}
  
{{end}}
{{end}}

{{define "kit-path-parameter-decode" -}}
        {{if (eq .Spec.Schema.Value.Format "path")}}
        {{.GoVariableName}}Str := chi.URLParam(r, "*")
	    {{ else }}
        {{.GoVariableName}}Str := chi.URLParam(r, "{{.ParamName}}")
	    {{ end }}

        {{if .Required }}
        if {{.GoVariableName}}Str == "" {
		   return nil, Error(http.StatusBadRequest, "missing required parameter '{{.ParamName}}'")
		}
        {{end}}

		var {{.GoVariableName}} *{{.Schema.GoType}}
		{{if eq .Schema.GoType "int" }}
  
            {{if not .Required}}
			if ok {
    		{{end}}

			{{.GoVariableName}}Param, err := strconv.Atoi({{.GoVariableName}}Str)
			if err != nil {
			  return nil, Error(http.StatusBadRequest, "invalid parameter '{{.ParamName}}', int required")
			}
			{{.GoVariableName}} = &{{.GoVariableName}}Param
			
		    {{if not .Required}}
			}
			{{end}}

          {{else if eq .Schema.GoType "int64"}}
          
            {{if not .Required}}
        if ok {
            {{end}}
        {{.GoVariableName}}Param, err := strconv.ParseInt({{.GoVariableName}}Str, 10, 64)
        if err != nil {
          return nil, Error(http.StatusBadRequest, "invalid parameter '{{.ParamName}}', int required")
        }
        {{.GoVariableName}} = &{{.GoVariableName}}Param
		
            {{if not .Required}}
        }
            {{end}}
        
        
          {{else if eq .Schema.GoType "float64"}}
          
            {{if not .Required}}
        if ok {
            {{end}}
        {{.GoVariableName}}Param, err := strconv.ParseFloat({{.GoVariableName}}Str, 64)
        if err != nil {
          return nil, Error(http.StatusBadRequest, "invalid parameter '{{.ParamName}}', double required")
        }
        {{.GoVariableName}} = &{{.GoVariableName}}Param
		
            {{if not .Required}}
        }
            {{end}}
        
        
          {{else if eq .Schema.GoType "string"}}
          
            {{if not .Required}}
        if ok {
            {{end}}
        {{.GoVariableName}} = &{{.GoVariableName}}Str
            {{if not .Required}}
        }
            {{end}}
        
          {{ else }}
          
            {{if not .Required}}
        if ok {
            {{end}}
        	{{.GoVariableName}}Cast := {{.Schema.GoType}}({{.GoVariableName}}Str)
            {{.GoVariableName}} = &{{.GoVariableName}}Cast
            {{if not .Required}}
        }
         {{end}}
  {{  if gt (len .Schema.EnumValues) 0 }}
// checking enum property '{{.ParamName}}'
  if {{.GoVariableName}} != nil && !IsValid{{.Schema.GoType}}(*{{.GoVariableName}}) {
  	 return nil, Error(http.StatusBadRequest, "invalid value for '{{.ParamName}}'")
  }
  {{ end }}
	
  {{end}}
  
{{end}}

{{define "kit-parameter-check" -}}
{{ range .Schema.Properties }}
{{ if .Required }}
  {{if eq .Schema.GoType "string" }}
// checking required property '{{.JsonFieldName}}'
  if body.{{.GoFieldName}} == "" {
  	 return nil, Error(http.StatusBadRequest, "missing required value for '{{.JsonFieldName}}'")
  }
  {{ else if .Schema.ArrayType }}
// checking required property '{{.JsonFieldName}}'
  if len(body.{{.GoFieldName}}) == 0 {
  	 return nil, Error(http.StatusBadRequest, "missing required value for '{{.JsonFieldName}}'")
  }
  {{ else if gt (len .Schema.EnumValues) 0 }}
// checking enum property '{{.JsonFieldName}}'
  if !IsValid{{.Schema.GoType}}(body.{{.GoFieldName}}) {
  	 return nil, Error(http.StatusBadRequest, "missing or invalid value for '{{.JsonFieldName}}'")
  }
  {{ end }}
{{ else }}
  {{  if gt (len .Schema.EnumValues) 0 }}
// checking enum property '{{.JsonFieldName}}'
  if body.{{.GoFieldName}} != nil && !IsValid{{.Schema.GoType}}(*body.{{.GoFieldName}}) {
  	 return nil, Error(http.StatusBadRequest, "invalid value for '{{.JsonFieldName}}'")
  }
  {{ end }}
{{ end }}
  
{{ end }}
{{- end }}

{{define "kit-function-signature-external-params" -}}
{{range $index, $param := .PathParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{- if not (or
	(eq "int" $param.Schema.GoType)
	(eq "int32" $param.Schema.GoType)
	(eq "int64" $param.Schema.GoType)
	(eq "float64" $param.Schema.GoType)
	(eq "float32" $param.Schema.GoType)
	(eq "string" $param.Schema.GoType)
	(eq "bool" $param.Schema.GoType)) -}}
api.
{{- end -}}
{{$param.Schema.GoType -}}
{{- end -}}
{{range $index, $param := .QueryParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{- if not (or
	(eq "int" $param.Schema.GoType)
	(eq "int32" $param.Schema.GoType)
	(eq "int64" $param.Schema.GoType)
	(eq "float64" $param.Schema.GoType)
	(eq "float32" $param.Schema.GoType)
	(eq "string" $param.Schema.GoType)
	(eq "bool" $param.Schema.GoType)) -}}
api.
{{- end -}}
{{$param.Schema.GoType -}}
{{- end -}}
{{range $index, $param := .HeaderParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{- if not (or
	(eq "int" $param.Schema.GoType)
	(eq "int32" $param.Schema.GoType)
	(eq "int64" $param.Schema.GoType)
	(eq "float64" $param.Schema.GoType)
	(eq "float32" $param.Schema.GoType)
	(eq "string" $param.Schema.GoType)
	(eq "bool" $param.Schema.GoType)) -}}
api.
{{- end -}}
{{$param.Schema.GoType -}}
{{- end -}}
{{range $index, $param := .CookieParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{- if not (or
	(eq "int" $param.Schema.GoType)
	(eq "int32" $param.Schema.GoType)
	(eq "int64" $param.Schema.GoType)
	(eq "float64" $param.Schema.GoType)
	(eq "float32" $param.Schema.GoType)
	(eq "string" $param.Schema.GoType)
	(eq "bool" $param.Schema.GoType)) -}}
api.
{{- end -}}
{{$param.Schema.GoType -}}
{{- end -}}
{{- end}}

{{define "kit-function-signature-params" -}}
{{range $index, $param := .PathParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{$param.Schema.GoType -}}
{{- end -}}
{{range $index, $param := .QueryParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{$param.Schema.GoType -}}
{{- end -}}
{{range $index, $param := .HeaderParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{$param.Schema.GoType -}}
{{- end -}}
{{range $index, $param := .CookieParams -}}
, {{- $param.GoVariableName}} {{if not $param.Required}}*{{end}}{{$param.Schema.GoType -}}
{{- end -}}
{{- end}}

{{define "kit-middleware-call-params" -}}
{{range $index, $param := .PathParams -}}
, {{- $param.GoVariableName}}
{{- end -}}
{{range $index, $param := .QueryParams -}}
, {{- $param.GoVariableName}}
{{- end -}}
{{range $index, $param := .HeaderParams -}}
, {{- $param.GoVariableName}}
{{- end -}}
{{range $index, $param := .CookieParams -}}
, {{- $param.GoVariableName}}
{{- end -}}
{{- end}}

{{define "kit-endpoint-call-params" -}}
{{range $index, $param := .PathParams -}}
, req.{{- $param.GoName}}
{{- end -}}
{{range $index, $param := .QueryParams -}}
, req.{{- $param.GoName}}
{{- end -}}
{{range $index, $param := .HeaderParams -}}
, req.{{- $param.GoName}}
{{- end -}}
{{range $index, $param := .CookieParams -}}
, req.{{- $param.GoName}}
{{- end -}}
{{- end}}

{{define "kit-middleware-call" -}}
(ctx
{{- template "kit-middleware-call-params" . -}}
{{- if .HasBody -}}
  {{range $index, $body := .Bodies -}}
    {{- if eq $index 0 -}}
, data
    {{- end -}}
  {{- end -}}
{{- end -}}
)
{{- end}}

{{define "kit-endpoint-call"}}
{{- $op := . -}}
(ctx
{{- template "kit-endpoint-call-params" . -}}
{{- if .HasBody -}}
  {{range $index, $body := .Bodies -}}
    {{- if eq $index 0 -}}
, {{if $op.AllParams}}req.Body{{else}}req{{end}}
    {{- end -}}
  {{- end -}}
{{- end -}}
)
{{- end}}

{{define "kit-function-signature" -}}
(ctx context.Context
{{- template "kit-function-signature-params" . -}}
{{- if .HasBody -}}
  {{range $index, $body := .Bodies -}}
    {{- if eq $index 0 -}}
, data {{$body.Schema.GoType}}
    {{- end -}}
  {{- end -}}
{{- end -}}
) {{ if not .GetResponseTypeDefinitions}} error {{else -}}
( 
{{- range $index, $return := .GetResponseTypeDefinitions -}}
{{- if $index }}, {{end -}}
*{{ $return.Schema.GoType }}
{{- end -}}
, error)
{{- end }}
{{- end}}

{{define "kit-function-signature-external" -}}
(ctx context.Context
{{- template "kit-function-signature-external-params" . -}}
{{- if .HasBody -}}
  {{range $index, $body := .Bodies -}}
    {{- if eq $index 0 -}}
, data api.{{$body.Schema.GoType}}
    {{- end -}}
  {{- end -}}
{{- end -}}
) {{ if not .GetResponseTypeDefinitions}} error {{else -}}
( 
{{- range $index, $return := .GetResponseTypeDefinitions -}}
{{- if $index }}, {{end -}}
*api.{{ $return.Schema.GoType }}
{{- end -}}
, error)
{{- end }}
{{- end}}
